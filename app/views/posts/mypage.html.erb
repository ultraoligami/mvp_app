<div class="container mt-5">
  <h1>マイページ</h1>
  <p class="text-muted">あなたが投稿した記録です</p>

  <!-- ▼ 上部アクションボタン群 -->
  <div class="d-flex flex-column flex-md-row gap-3 mb-4">

    <%= link_to "新規投稿",
                new_post_path,
                class: "btn app-action-btn secondary" %>

    <%= link_to "プロフィールを編集する",
                edit_user_registration_path,
                class: "btn app-action-btn secondary" %>

    <%= link_to "カレンダーを見る",
                "#calendar-section",
                class: "btn app-action-btn secondary" %>

    <%= link_to "グラフを見る",
                "#graph-section",
                class: "btn app-action-btn secondary" %>
  </div>
  <!-- ▲ 上部アクションここまで -->

  <hr>

  <% if @posts.any? %>

    <!-- ▼ カテゴリー比率グラフ -->
    <div id="graph-section" class="my-5 text-center">
      <h4>カテゴリー別投稿比率</h4>
      <%= pie_chart @category_data,
                    height: "300px",
                    library: { legend: { position: "bottom" } } %>
    </div>

    <hr>

    <!-- ▼ カレンダー -->
    <div id="calendar-section" class="my-5">
      <%= render "calendar" %>
    </div>

    <hr>

    <!-- ▼ 投稿一覧 -->
    <% @posts.each do |post| %>
      <div class="post-card">
        <%= image_tag "pin.png", class: "pin-left" %>
        <%= image_tag "pin.png", class: "pin-right" %>

        <h3>
          <%= link_to post.title,
                      post_path(post),
                      class: "post-title-link" %>
        </h3>

        <p class="text-muted">ジャンル：<%= post.category %></p>
        <p><%= truncate(post.content, length: 100) %></p>
        <p class="text-muted small"><%= l post.created_at, format: :long %></p>

        <%= link_to "詳細を見る",
                    post_path(post),
                    class: "btn app-action-btn secondary mt-2" %>
      </div>
    <% end %>

  <% else %>

    <div class="text-center my-5">
      <h4>まだ投稿がありません</h4>
      <p class="text-muted">まずは記録をしてみましょう！</p>

      <%= link_to "初めての投稿をする",
                  new_post_path,
                  class: "btn app-action-btn primary mt-3" %>
    </div>

  <% end %>
</div>